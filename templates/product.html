{% extends "base.html" %}
{% load staticfiles %}

{% block content %}

    <script src="{% static "js/jquery-1.11.1.min.js" %}"></script>
    <link href="{% static 'css/product_entry.css'%}" rel="stylesheet">

    <script type="text/javascript">var switchTo5x=true;</script>
    <script type="text/javascript" src="https://ws.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript">stLight.options({publisher: "1d0d7a7d-7be0-4769-ab66-f1a5620bb556", doNotHash: false, doNotCopy: false, hashAddressBar: true});</script>
    <script type="text/javascript" src="http://coolcarousels.frebsite.nl/js/jquery.js"></script>
  <script type="text/javascript" src="http://coolcarousels.frebsite.nl/js/jquery.carouFredSel.js"></script>


    <div id="alert_msg" class="" style="display:none;"></div>
    <div class="row featurette">
        <div class="col-md-7 product_detail">

          <div id='carousel-custom' class='carousel slide row' data-ride='carousel'>
            <!-- Indicators -->
    <div class="col-sm-3">
    <ol class='carousel-indicators mCustomScrollbar'>
        <li data-target='#carousel-custom' data-slide-to='0' class='active'><img src='http://placehold.it/100x50&text=slide1' alt='' /></li>
        <li data-target='#carousel-custom' data-slide-to='1'><img src='http://placehold.it/100x50&text=slide2' alt='' /></li>
        <li data-target='#carousel-custom' data-slide-to='2'><img src='http://placehold.it/100x50&text=slide3' alt='' /></li>
    </ol>
    </div>
    <div class='carousel-outer col-sm-9'>
        <!-- Wrapper for slides -->
        <div class='carousel-inner'>
            <div class='item active'>
                <img src='http://placehold.it/400x200&text=slide1' alt='' />
            </div>
            <div class='item'>
                <img src='http://placehold.it/400x200&text=slide2' alt='' />
            </div>
            <div class='item'>
                <img src='http://placehold.it/400x200&text=slide3' alt='' />
            </div>
        </div>
            
        <!-- Controls -->
        <a class='left carousel-control' href='#carousel-custom' data-slide='prev'>
            <span class='glyphicon glyphicon-chevron-left'></span>
        </a>
        <a class='right carousel-control' href='#carousel-custom' data-slide='next'>
            <span class='glyphicon glyphicon-chevron-right'></span>
        </a>
    </div>
    
    
</div>
<span id="like">230000+</span><span id="heart" class="glyphicon glyphicon-heart"></span>
          <!--<img id="mainImg" class="img-thumbnail" alt="Generic placeholder image">
           <div id="social_block">
                <span class='st_facebook_large' st_title="1 dots | {{ product.product_name }}" st_image="https://popdesign.s3.amazonaws.com/test/static/products/20150000004/main.jpg"></span>
                <span class='st_twitter_large'></span>
                <span class='st_googleplus_large'></span>
                <span class='st_linkedin_large'></span>
                <span class='st_pinterest_large'></span>
            </div>-->
        </div>
        <div class="col-md-4 col-md-offset-1 product_info">
        <h1 id="product_name"></h1>
                  <p id="product_code"></p>

          <span id="regular_price"></span>&nbsp;<span id="sale_price"></span>&nbsp;<span id="is_in_stock"></span>
          <h3 id="number_in_stock">{{ product.number_in_stock }}</h3>
                <br />

          <h4>Description</h4>
          <small id="product_description">{{ product.description | safe }}</small>
          <form class="form-horizontal"> 
          <div class="form-group size">
          <label class="col-sm-2">Size</label>
          <div class="col-sm-4">
          <select class="form-control">
  <option>XS</option>
  <option>S</option>
  <option>M</option>
  <option>L</option>
</select>
</div>
</div>
<div class="form-group size">
          <label class="col-sm-2">Color</label>
          <div class="col-sm-4">
          <select class="form-control">
  <option>Red</option>
  <option>Yellow</option>
  <option>Blue</option>
  <option>Brown</option>
</select>
</div>
</div>
<div class="form-group size">
          <label class="col-sm-2">Qty</label>
          <div class="col-sm-4">
          <select class="form-control">
  <option>1</option>
  <option>2</option>
  <option>3</option>
  <option>4</option>
</select>
</div>
</div>
</form>
          <br />

          <!--<button id="product_like" class="btn btn-default btn-primary"><span id="like_count" class="badge">{{ product.number_like }}</span> Like<i style="margin-left: 5px;" class="glyphicon glyphicon-thumbs-up"></i></button>
          <br />-->

              <button id="add_to_cart" class="btn btn-default btn-block"><i style="margin-right: 5px;" class="glyphicon glyphicon-shopping-cart"></i>Add to cart</button>
              {% if show_create %}
            <a id="create_group" class="btn btn-info btn-block"><span style="margin-right: 5px;" class="glyphicon glyphicon-user"></span>Create M-Group</a>
          {% else %}
            <a id="view_group" class="btn btn-info btn-block"><span style="margin-right: 5px;" class="glyphicon glyphicon-user"></span>See created group</a>
          {% endif %}
              <!--<button id="add_to_wishlist" class="btn btn-default"><i style="margin-right: 5px;" class="glyphicon glyphicon-heart-empty"></i>Add to wishlist</button>-->
        </div>
      </div>
      <div class="row bottom-info-header">
      <div class="col-md-7  header">
      <h4 class="title">Product Info</h4>
      </div>
      <div class="col-md-4 col-md-offset-1 header">
      <h4 class="title">M-Group</h4>
      </div>
      </div>
      <div class="row bottom-info my-row">
      <div class="col-md-7">
      <h6 class="title">More Details</h6>
      <p></p>
        <h6 class="title">Care</h6>
<p></p>
      <h6 class="title">Finish</h6>
<p></p>
      <h6 class="title">Material</h6>
<p></p>
      </div>
      <div class="col-md-4 col-md-offset-1">
      </div>
      </div>


        <script type="text/javascript">
        var host = window.location.origin;
        var image_dir = "{{ storage_host }}" + "{% static 'products/' %}";
        var prod_pk = {{ product.pk }};
        var btn_add = $('#add_to_cart');
        var btn_add_wish = $('#add_to_wishlist');
        var btn_remove_cart = $('#remove_from_cart');
        var btn_remove_wish = $('#remove_from_wish');
        var btn_like_product = $("#product_like");
        var number_product_like = {{ product.number_like }};

        // loading page section
        $( document ).ready(ajaxCall());

        function ajaxCall(){
            var api_url = host + "/api/products/" + prod_pk + "/?format=json";
            $.ajax({
            type: "GET",
            url: api_url,
            dataType: "json"
            }).success(function(data, textStatus, jqXHR){

                loadPage(data);

                reviews();
            }).fail(function(jqXHR, textStatus){
                $("#alert_msg").attr("class", "alert alert-warning").html("action failed  !").fadeIn(1000, 0).fadeOut(2000, 0);
            });
            $("#create_group").attr('href', generate_group_url());
            $("#view_group").attr('href', generate_group_url());
        }

        function loadPage(data){
            loadProduct(data);

        }

        function loadProduct(results){
            var img_url = image_dir + results.image_root;
            $('#mainImg').attr('src', img_url);
            $('#product_name').html(results.product_name);

            $('#regular_price').html("$" + results.price);
            if(results.is_active == false){
                $("#number_in_stock").hide();
                $('#is_in_stock').html("(out of stock)").attr('style', "color:red; font-size:small");
{#                $("#add_to_cart").prop("disabled", true);#}
            }
            else{
                $("#number_in_stock").show();
            }
            $('#product_code').html(results.product_code);

            bound_social_btn(img_url, results.product_name, "");
        }

        function bound_social_btn(image_url, title, description){
            set_social_template($('.st_facebook_large'), image_url, title, description);
            set_social_template($('.st_twitter_large'), image_url, title, description);
            set_social_template($('.st_googleplus_large'), image_url, title, description);
            set_social_template($('.st_linkedin_large'), image_url, title, description);
            set_social_template($('.st_pinterest_large'), image_url, title, description);
        }

        function set_social_template(btn_class, image_url, title, description){
            btn_class.attr('st_title', title).attr('st_image', image_url).attr('st_summary', description);
        }

        function clearAll(){
            container.empty()
        }
        // End section

        // adding or removing products section
        btn_add.on('click', function(){
            $.ajax({
            type: "POST",
            url: host + "/api/cart/" + prod_pk + "/add/",
            dataType: "json"
            }).success(function(data, textStatus, jqXHR){
                request_success();
            }).fail(function(jqXHR, textStatus){
                request_failed();
            });
        });

        btn_add_wish.on('click', function(){
            $.ajax({
            type: "POST",
            url: host + "/api/wish/" + prod_pk + "/add/",
            dataType: "json"
            }).success(function(data, textStatus, jqXHR){
                request_success();
            }).fail(function(jqXHR, textStatus){
                request_failed();
            });
        });

        btn_like_product.on('click', function(){
            $.ajax({
            type: "POST",
            url: host + "/api/like/" + prod_pk + "/",
            dataType: "json"
            }).success(function(data, textStatus, jqXHR){
                $("#like_count").html(++number_product_like);
                btn_like_product.prop("disabled", true);
                request_success();
            }).fail(function(jqXHR, textStatus){
                request_failed();
            });
        });

        function request_success(){
            $("#alert_msg").attr("class", "alert alert-success").html("action success !").fadeIn(1000, 0).fadeOut(2000, 0);
        }

        function request_failed(){
            $("#alert_msg").attr("class", "alert alert-warning").html("action failed, please login !").fadeIn(1000, 0).fadeOut(2000, 0);
        }

        function generate_group_url(){
            return host + "/microgroup/" + prod_pk + "/{{ group.pk }}/";
        }
        // End section

        // product reviews
        function reviews(){
            var product_lite = $('<p></p>');
            $.ajax({
            type: "GET",
            url: host + "/api/reviews/?format=json&product_id=" + prod_pk,
            dataType: "json"
            }).success(function(data, textStatus, jqXHR){
                $.each(data.results, function(i, item){
{#                    var elem = product_lite.clone();#}
{#                    elem.find('p').html(item.pk);#}
{#                    $("#product_review").append(elem);#}
{##}
{#                    console.log(item.pk);#}
                    $("#product_review").val(item.product_name);
                });
            }).fail(function(jqXHR, textStatus){
                request_failed();
            });
        }
        // end section
    </script>

{% endblock %}